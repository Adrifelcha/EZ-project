---
title: "Perception example of EZBHDDM"
author: "Adriana F. Chávez De la Peña and Joachim Vandekerckhove"
date: "`r Sys.Date()`"
output:
  rmdformats::robobook:
    self_contained: true
    thumbnails: true
    lightbox: true
    gallery: false
    highlight: tango
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
# Introduction

Data from [Ratcliff and Rouder (1998)](https://journals.sagepub.com/doi/pdf/10.1111/1467-9280.00067), experiment 1, participant N.H.:

> ''...subjects were asked to decide whether the overall brightness of pixel arrays displayed on a computer monitor was “high” or “low” (Fig. 3a). The brightness of a display was controlled by the proportion of the pixels that were white. For each trial, the proportion of white pixels was chosen from one of two distributions, a high distribution or a low distribution, each with fixed mean and standard deviation (Fig. 3b). Feedback was given after each trial to tell the subject whether his or her decision had correctly indicated the distribution...''
>

There are 66 cells in the design. 1-33 had an accuracy instruction, 34-66 a speed instruction. 1-16 and 34-49 had more black pixels and 18-33 and 51-66 had more white. 17 and 50 were ambiguous and will not be used here.

```{r}
# Load necessary libraries/packages
library(rmdformats)
```

# Loading and cleaning the data

```{r}
# Load the data from one participant
data_raw <- read.csv("./nh.tsv", sep = "")
colnames(data_raw) <- c("index","cond","response","RT")
head(data_raw)

# Dataset dimmensions
dim(data_raw)
```

```{r}
# Create a copy of the raw data file 
data <- data_raw

# Get 'accuracy' binary coding based on the condition and response in raw data file
accuracy <- as.integer(data_raw$cond > 0  & data_raw$cond < 17 & data_raw$response==1|
                       data_raw$cond > 17 & data_raw$cond < 34 & data_raw$response==2|
                       data_raw$cond > 33 & data_raw$cond < 50 & data_raw$response==1|
                       data_raw$cond > 50 & data_raw$cond < 67 & data_raw$response==2)

# Update the 'response' column of the data copied so it reflects accuracy
data$response <- accuracy

# Remove rows where RT > 3000ms
data <- data[which(data$RT<=3000),]
```

# Get summary statistics

```{r}
# Initialize an empty output data frame (df)
tmp <- matrix(0,nrow = 66,ncol = 6)
df <- as.data.frame(tmp)
colnames(df) <- c("nTrials", "sum_accuracy", "mean_rt_correct",
                  "variance_rt_correct", "Xi", "Xs")
head(df)
```

```{r}
# Define a function to compute the summary statistics used by EZ-DDM
ez_summaries <- function(subset){
  # Identify condition ID
  cond <- unique(subset$cond)
  cond2 <- as.integer(cond>33)-0.5
  # Return relevant summary statistics
  return(data.frame("nTrials" = nrow(subset),
                    "accRate" = sum(subset$response),
                    "meanRT"  = mean(subset$RT)/1000,
                    "varRT"   = var(subset$RT/1000),
                    "cond"    = cond2,
                    "scale"   = ((cond2-1) %% 33 - 16)/5))
}
```
