---
title: "EZBHDDM: Short exercise on hypothesis testing"
author: "Adriana F. Chávez De la Peña"
date: "`r Sys.Date()`"
output:
  rmdformats::material:
    self_contained: true
    thumbnails: false
    lightbox: true
    gallery: true
    cards: false
    highlight: tango
    fig_width: 12 
    fig_height: 8 
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
library(rmdformats)
```

# Introduction

\begin{align*}
\mathbf{Y} \sim \mbox{DDM}\bigl(\alpha, \nu, \tau \bigl)
\end{align*}

## The EZBHDDM

\begin{align*}
Y &\Rightarrow \{\dot{T}, \dot{M}, \dot{V}\}\\
\dot{T} &\sim \mbox{Binomial}(PC,N)\\
\dot{V} &\sim \mbox{Normal}(\frac{1}{PRT},\frac{N-1}{2(PRT)^2})\\
\dot{M} &\sim \mbox{Normal}(MRT, PRT \times N)\\
PC &= \frac{1}{\exp(-\alpha\nu)+1}\\
MRT &= \tau + \frac{\alpha}{2\nu}\frac{\exp(-\alpha\nu)-1}{\exp(-\alpha\nu)+1}\\
PRT &= \frac{\alpha}{2\nu^3}\{\frac{1-2\alpha\nu\exp(-\alpha\nu)-\exp(-\alpha\nu)^2}{(\exp(-\alpha\nu)+1)^2}\}
\end{align*}

## Model Types included in this template

1. `hierarchical`

2. `metaregression`

3 .`ttest`

# Custom functions

## Simulation setup functions

```{r, echo=FALSE}
for(archive in dir("../../code/functions/")){    source(paste("../../code/functions/",archive,sep=""))     }
for(archive in dir("../../code/scripts/")){    
  if(length(which(grepl("HDDM",archive)))!=0){  source(paste("../../code/scripts/",archive,sep="")) }    
}
source("../../code/scripts/HDDM_simFixedEffect.R")
source("./writefixEffJAGSmodel.R")
```


```{r}
x <- HDDM_simFixedEffect(nParticipants = 50, nTrialsPerCondition = 200, nDatasets = 1000, beta.effect = 0.5, 
                         priors = NA, n.chains = 4, Show = TRUE, forceSim = FALSE, fromPrior = TRUE)

y <- HDDM_simFixedEffect(nParticipants = 50, nTrialsPerCondition = 200, nDatasets = 1000, beta.effect = 0, 
                         priors = NA, n.chains = 4, Show = TRUE, forceSim = FALSE, fromPrior = TRUE, label= "Null")
```

```{r}
beta_noDiff <- y$estimates[,"betaweight"]
beta_Diff <- x$estimates[,"betaweight"]

plot(density(beta_noDiff))
plot(density(beta_Diff))

topY <- max(density(beta4)[2]$y)*1.05
    hist(beta4, freq = FALSE, breaks = 50, col=density.color, border = density.color, ann=F, axes = F,xaxs = "i", yaxs = "i", xlim=c(0,1.6), ylim = c(0,topY))
    lines(density(beta4), lwd=4, col=line.color)
    mtext("Density",side=2,line=2.15)
    mtext("Beta-4",side=1,line=2)
    axis(1,seq(0,1.6,0.4),seq(0,1.6,0.4))
    axis(2,seq(0,2,0.5),seq(0,2,0.5),las=2)
    mtext("Main effect", f=2, cex=1.2)
    abline(v=0,lty=2)
    
    hist(beta3, freq = FALSE, breaks = 50, col=density.color, border = density.color, ann=F, axes = F, xaxs = "i", yaxs = "i", ylim=c(0,topY))
    lines(density(beta3), lwd=4, col=line.color)
    axis(1,seq(0,1.6,0.4),seq(0,1.6,0.4))
    mtext("Beta-3",side=1,line=2)
    mtext("Effect on slope", f=2, cex=1.2)
    abline(v=0,lty=2)
    mtext("Effect of instruction on the drift rate",3,outer=TRUE, f=2, line=-2.5, cex=1.5)

```